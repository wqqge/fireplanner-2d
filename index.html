<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>ðŸŽ† FirePlanner 2D - Pro Advanced (Final)</title>
<style>
/* ==== GRUNDLAYOUT ==== */
body {
  box-sizing: border-box;
  font-family: Arial, sans-serif;
  margin: 0;
  background: #111;
  color: #eee;
}
h1, h2 { text-align: center; margin: 10px 0; }
input, button, select, textarea {
  margin: 5px; padding: 8px;
  background: #222; color: #fff;
  border: 1px solid #555; border-radius: 5px;
  font-size: 14px; outline: none;
}
input:focus, textarea:focus, select:focus {
  background: #333; border-color: #4caf50;
  box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
}
input[type="text"], input[type="number"], textarea { width: 200px; max-width: 100%; }
button {
  cursor: pointer; background: #444; transition: 0.2s; padding: 10px 15px;
}
button:hover { background: #666; }
#container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
#effectList { max-width: 400px; margin: 10px; }
.effect-item {
  border: 1px solid #555; padding: 10px; margin: 8px 0;
  border-radius: 5px; background: #222; cursor: move;
  display: flex; justify-content: space-between; align-items: center;
  transition: all 0.2s;
}
.effect-item:hover { background: #333; transform: translateY(-2px); }
.effect-item.dragging { opacity: 0.5; transform: rotate(5deg); }
.effect-item.low-stock { border-color: #ff9800; background: #2d1b0f; }
.effect-item.out-of-stock { border-color: #f44336; background: #2d0f0f; }
#canvasContainer {
  position: relative; margin: 10px auto;
  border: 2px solid #555; background: #000; border-radius: 8px;
}
#fireworkCanvas { cursor: crosshair; display: block; border-radius: 6px; }
#timerDisplay {
  font-size: 3em; text-align: center; margin: 20px 0; font-weight: bold; color: #0ff;
}
#currentEffect {
  font-size: 1.4em; color: #ff0; text-align: center; margin: 15px 0;
  padding: 10px; background: #222; border-radius: 5px; min-height: 60px;
}
#warning {
  font-size: 2.5em; color: #f00; text-align: center;
  margin: 15px 0; font-weight: bold;
}
.controls {
  text-align: center; margin: 20px 0; padding: 15px; background: #222; border-radius: 8px;
}
.effect-delete {
  background: #d32f2f; color: white; border: none; padding: 5px 8px;
  border-radius: 3px; cursor: pointer; font-size: 12px;
}
.effect-delete:hover { background: #b71c1c; }
#costCalculation {
  text-align: center; margin: 20px 0; padding: 15px;
  background: #1a4d1a; border-radius: 8px; border: 2px solid #2e7d32;
}
#totalCost { font-size: 1.5em; font-weight: bold; color: #81c784; }
#effectCount { color: #a5d6a7; margin-top: 5px; }
#effectOverview {
  text-align: center; margin: 20px 0; padding: 15px;
  background: #1a1a2e; border-radius: 8px; border: 2px solid #16213e;
}
.overview-table {
  width: 100%; border-collapse: collapse; background: #222; border-radius: 5px;
}
.overview-table th {
  background: #333; color: #fff; padding: 10px 8px; text-align: left;
  font-size: 12px; border-bottom: 2px solid #555;
}
.overview-table td {
  padding: 8px; border-bottom: 1px solid #444; font-size: 11px; color: #ddd;
}
.overview-table tr:hover { background: #2a2a2a; }

/* ==== DRUCKVERSION ==== */
@media print {
  button, select, input, textarea, .effect-delete, .effect-edit { display: none !important; }
  .controls, #container > #effectList { display: none !important; }
  #planScreen > *:not(#printArea):not(#effectOverview):not(#costCalculation) { display: none !important; }
  #printArea, #effectOverview, #costCalculation { display: block !important; }
  .overview-table th { background-color: #f0f0f0 !important; color: #000 !important; }
  .overview-table td { color: #000 !important; }
  * { overflow: visible !important; }
}
</style>
</head>
<body>

<h1>ðŸŽ† FirePlanner 2D - Pro Advanced</h1>

<div id="planScreen">
  <h2>Show-Name</h2>
  <input id="showName" placeholder="Name der Show">

  <h2>Effekt hinzufÃ¼gen</h2>
  <input id="name" placeholder="Effektname">
  <select id="effectType">
    <option value="rocket">Rakete</option>
    <option value="fountain">FontÃ¤ne</option>
    <option value="battery">Batterie</option>
  </select>
  <input id="plannedDuration" placeholder="Dauer (m:s)">
  <input id="price" placeholder="Preis (â‚¬)" type="number" step="0.01">
  <input id="barcode" placeholder="Barcode/EAN">
  <input id="time" placeholder="Showzeit (m:s)">
  <input id="channel" placeholder="Kanal" type="number" min="1">
  <input id="receiver" placeholder="EmpfÃ¤nger">
  <input id="buttonKey" placeholder="Taste">
  <input id="quantity" placeholder="Anzahl Effekte">
  <textarea id="additionalInfo" placeholder="Zusatzinfos"></textarea>
  <button onclick="addEffect()">Effekt speichern</button>

  <div id="container">
    <div id="canvasContainer">
      <canvas id="fireworkCanvas" width="800" height="500"></canvas>
    </div>
    <div id="effectList"></div>
  </div>

  <div id="costCalculation">
    <h3>ðŸ’° Kostenkalkulation</h3>
    <div id="totalCost">Gesamtkosten: 0,00 â‚¬</div>
    <div id="effectCount">Anzahl Effekte: 0</div>
  </div>

  <div id="effectOverview">
    <h3>ðŸ“‹ Effekt-Ãœbersicht</h3>
    <div id="overviewTable"></div>
  </div>

  <div class="controls">
    <button onclick="saveShow()">Show speichern</button>
    <button onclick="loadSavedShows()">Show laden</button>
    <select id="savedShows" onchange="selectShow()">
      <option value="">Gespeicherte Shows</option>
    </select>
    <button onclick="exportShow()">Export JSON</button>
    <input type="file" id="importFile" accept=".json" onchange="importShow()">
    <button onclick="printPlan()">Druckversion</button>
    <button onclick="startShow()">Show starten</button>
    <button onclick="stopShow()">Stopp</button>
  </div>
</div>

<div id="showScreen" style="display:none;">
  <h2>Show Timer</h2>
  <div id="timerDisplay">00:00</div>
  <div id="warning"></div>
  <div id="currentEffect"></div>
  <button onclick="backToPlan()" style="margin: 20px;">ZurÃ¼ck zur Planung</button>
</div>

<div class="print-area" id="printArea"></div>

<script>
let effects = [];
let canvas, ctx;

window.onload = function() {
  canvas = document.getElementById('fireworkCanvas');
  ctx = canvas.getContext('2d');
  loadSavedShows();
  drawCanvas();
};

function addEffect() {
  const name = document.getElementById('name').value.trim();
  const time = document.getElementById('time').value.trim();
  if (!name || !time) { alert("Bitte Name und Zeit eingeben!"); return; }
  const newEffect = {
    id: Date.now(),
    name: name,
    effectType: document.getElementById('effectType').value,
    plannedDuration: document.getElementById('plannedDuration').value,
    price: parseFloat(document.getElementById('price').value) || 0,
    barcode: document.getElementById('barcode').value,
    time: time,
    channel: document.getElementById('channel').value,
    receiver: document.getElementById('receiver').value,
    buttonKey: document.getElementById('buttonKey').value,
    quantity: parseInt(document.getElementById('quantity').value) || 1,
    additionalInfo: document.getElementById('additionalInfo').value
  };
  effects.push(newEffect);
  updateEffectList();
  updateCostCalculation();
  updateEffectOverview();
}

function updateEffectList() {
  const list = document.getElementById('effectList');
  list.innerHTML = '<h3>Effekte in der Show</h3>';
  effects.forEach(e => {
    const div = document.createElement('div');
    div.className = 'effect-item';
    div.innerHTML = `<div><strong>${e.name}</strong><br>Zeit: ${e.time} | Typ: ${e.effectType}</div>
      <button class="effect-delete" onclick="deleteEffect(${e.id})">Ã—</button>`;
    list.appendChild(div);
  });
}

function updateCostCalculation() {
  let total = 0; let count = 0;
  effects.forEach(e => { total += e.price * e.quantity; count += e.quantity; });
  document.getElementById('totalCost').textContent = "Gesamtkosten: " + total.toFixed(2) + " â‚¬";
  document.getElementById('effectCount').textContent = "Anzahl Effekte: " + count;
}

function updateEffectOverview() {
  const overview = document.getElementById('overviewTable');
  if (effects.length === 0) { overview.innerHTML = "<p>Keine Effekte</p>"; return; }
  let html = `<table class="overview-table"><tr>
    <th>Zeit</th><th>Name</th><th>Typ</th><th>Dauer</th><th>Preis</th><th>Anzahl</th></tr>`;
  effects.forEach(e => {
    html += `<tr><td>${e.time}</td><td>${e.name}</td><td>${e.effectType}</td>
      <td>${e.plannedDuration}</td><td>${e.price.toFixed(2)} â‚¬</td><td>${e.quantity}</td></tr>`;
  });
  html += "</table>";
  overview.innerHTML = html;
}

function deleteEffect(id) {
  effects = effects.filter(e => e.id !== id);
  updateEffectList();
  updateCostCalculation();
  updateEffectOverview();
}

function saveShow() {
  localStorage.setItem("fireplanner_show", JSON.stringify(effects));
  alert("Show gespeichert!");
}
function loadSavedShows() {
  const saved = localStorage.getItem("fireplanner_show");
  if (saved) effects = JSON.parse(saved);
  updateEffectList();
  updateCostCalculation();
  updateEffectOverview();
}
function exportShow() {
  const blob = new Blob([JSON.stringify(effects, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "show.json"; a.click();
}
function importShow() {
  const fileInput = document.getElementById("importFile");
  const file = fileInput.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => { effects = JSON.parse(e.target.result); updateEffectList(); updateCostCalculation(); updateEffectOverview(); };
  reader.readAsText(file);
}
function printPlan() { window.print(); }
function drawCanvas() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "white";
  ctx.fillText("ðŸŽ† Platz fÃ¼r Show", 10,20);
}
function startShow() {
  document.getElementById('planScreen').style.display="none";
  document.getElementById('showScreen').style.display="block";
}
function stopShow() {
  document.getElementById('planScreen').style.display="block";
  document.getElementById('showScreen').style.display="none";
}
function backToPlan() { stopShow(); }
</script>
</body>
</html>
